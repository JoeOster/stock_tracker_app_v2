# Portfolio V4.1 User Acceptance Criteria (UAC)

This document contains the official test scripts. The "UAC Verification" step in the refactor plan passes **only** if all scripts for that module pass.

---

## **UAC - Ledger**

- [ ] 1. **Load:** GIVEN I am on the Ledger tab, THEN the transaction table loads correctly.
- [ ] 2. **Filter:** GIVEN I change the "Group By" filter to "Ticker," THEN the table re-renders and groups by ticker.
- [ ] 3. **Expand:** GIVEN I click a "Sell" row, THEN the sales history for that position expands, and the P/L calculation is correct.

---

### **UAC - Strategy Lab (formerly Watchlist)**

- [ ] 1. **Load:** GIVEN I am on the "Strategy Lab" tab, THEN I see two sub-tabs: "Paper Trades" and "Watchlist".
- [ ] 2. **Decoupling Check:** GIVEN I am on this tab, THEN I **do not** see any of my "Real Positions".
- [ ] 3. **Paper Trades:** GIVEN I click the "Paper Trades" sub-tab, THEN I can see my paper portfolio.
- [ ] 4. **Watchlist:** GIVEN I click the "Watchlist" sub-tab, THEN I can see my simple list of watched tickers.
- [ ] 5. **Add Ticker:** GIVEN I am on the "Watchlist" sub-tab, WHEN I add a new ticker, THEN it appears in the list.

---

### **UAC - Dashboard**

- [ ] 1. **Load:** GIVEN I am on the Dashboard tab, THEN the "Portfolio Summary" and "Open Positions" (Real Positions) tables load.
- [ ] 2. **Open Manage Modal:** GIVEN I click a "Real Position" row, THEN the "Manage Position" modal opens with the correct data.
- [ ] 3. **Open Sell Modal:** GIVEN I am in the "Manage Position" modal and click "Sell/Reduce," THEN the "Sell from Position" modal opens.
- [ ] 4. **Submit Sale:** GIVEN I submit a sale, THEN the modal closes, a toast appears, and the Dashboard data refreshes automatically (via `dispatchDataUpdate()`).
- [ ] 5. **Open Edit Modal:** GIVEN I am in the "Manage Position" modal, expand a lot, and click "Edit," THEN the "Edit Transaction" modal opens.

---

### **UAC - Sources**

- [ ] 1. **Load:** GIVEN I am on the Sources tab, THEN the list of sources loads.
- [ ] 2. **Add Source:** GIVEN I fill out the "Add New Source" form and click "Save," THEN the new source appears in the list.
- [ ] 3. **Open Details:** GIVEN I click a source, THEN the "Source Details" modal appears.
- [ ] 4. **Create Idea from Source:** GIVEN I am in "Source Details" and click "Add Idea," THEN the "Add Trade Idea" modal opens, pre-filled with the source ID.

---

### **UAC - Orders**

- [ ] 1. **Load:** GIVEN I am on the Orders tab, THEN the "Pending Orders" table and "Log Executed Trade" form load.
- [ ] 2. **Prefill:** GIVEN I click "Buy" on a "Sources" trade idea, THEN I am navigated to the Orders tab and the form is pre-filled.
- [ ] 3. **Submit Order:** GIVEN I fill out the "Log Executed Trade" form and click "Submit," THEN a success toast appears and the `dispatchDataUpdate()` event fires.
- [ ] 4. **Cancel Order:** GIVEN I click "Cancel" on a pending order, THEN the confirm modal appears, and the order is removed on confirmation.

---

### **UAC - Alerts**

- [ ] 1. **Load:** GIVEN I am on the Alerts tab, THEN any pending price alerts are displayed.
- [ ] 2. **Dismiss Alert:** GIVEN I click "Dismiss" on an alert, THEN the alert is hidden.
- [ ] 3. **Prefill Order:** GIVEN I click "Yes, It Filled" on an alert, THEN I am navigated to the "Orders" tab, and the form is pre-filled with the alert's order data.

---

### **UAC - Imports (The Broken Tab)**

- [ ] 1. **Load:** GIVEN I am on the Imports tab, THEN the "Import Into Account" dropdown is populated with my accounts.
- [ ] 2. **Show Reconciliation:** GIVEN I select an account, a template, and a CSV file, WHEN I click "Review & Reconcile," THEN the "Step 2: Review and Resolve" section appears (`display: 'block'`).
- [ ] 3. **Cancel:** GIVEN "Step 2" is visible, WHEN I click "Cancel," THEN the "Step 2" section is hidden.
- [ ] 4. **Commit:** GIVEN "Step 2" is visible, WHEN I click "Commit Changes," THEN a success toast appears and the `dispatchDataUpdate()` event fires.
